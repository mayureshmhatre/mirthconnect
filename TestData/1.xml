<transformer version="3.3.1">
  <steps>
    <step>
      <sequenceNumber>0</sequenceNumber>
      <name>patientid</name>
      <script>var mapping;

try {
	mapping = msg[&apos;PID&apos;][&apos;PID.2&apos;][&apos;PID.2.1&apos;].toString(); 
} catch (e) {
	logger.error(e);
	mapping = &apos;&apos;;
}

channelMap.put(&apos;patientid&apos;, validate( mapping , &apos;&apos;, new Array()));</script>
      <type>Mapper</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>patientid</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string>msg[&apos;PID&apos;][&apos;PID.2&apos;][&apos;PID.2.1&apos;].toString()</string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list/>
        </entry>
        <entry>
          <string>isGlobal</string>
          <string>channel</string>
        </entry>
      </data>
    </step>
    <step>
      <sequenceNumber>1</sequenceNumber>
      <name>family_name</name>
      <script>var mapping;

try {
	mapping = msg[&apos;PID&apos;][&apos;PID.9&apos;][&apos;PID.9.1&apos;].toString(); 
} catch (e) {
	logger.error(e);
	mapping = &apos;&apos;;
}

channelMap.put(&apos;family_name&apos;, validate( mapping , &apos;&apos;, new Array()));</script>
      <type>Mapper</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>family_name</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string>msg[&apos;PID&apos;][&apos;PID.9&apos;][&apos;PID.9.1&apos;].toString()</string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list/>
        </entry>
        <entry>
          <string>isGlobal</string>
          <string>channel</string>
        </entry>
      </data>
    </step>
    <step>
      <sequenceNumber>2</sequenceNumber>
      <name>given_name</name>
      <script>var mapping;

try {
	mapping = msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.2&apos;].toString(); 
} catch (e) {
	logger.error(e);
	mapping = &apos;&apos;;
}

channelMap.put(&apos;given_name&apos;, validate( mapping , &apos;&apos;, new Array()));</script>
      <type>Mapper</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>given_name</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string>msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.2&apos;].toString()</string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list/>
        </entry>
        <entry>
          <string>isGlobal</string>
          <string>channel</string>
        </entry>
      </data>
    </step>
    <step>
      <sequenceNumber>3</sequenceNumber>
      <name>Date_of_Birth</name>
      <script>var mapping;

try {
	mapping = DateUtil.convertDate(&quot;yyyyMMdd&quot;, &quot;MMMM dd, yyyy&quot; , msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString()); 
} catch (e) {
	logger.error(e);
	mapping = &apos;&apos;;
}

channelMap.put(&apos;Date_of_Birth&apos;, validate( mapping , &apos;&apos;, new Array()));</script>
      <type>Mapper</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>Date_of_Birth</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string>DateUtil.convertDate(&quot;yyyyMMdd&quot;, &quot;MMMM dd, yyyy&quot; , msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString())</string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list/>
        </entry>
        <entry>
          <string>isGlobal</string>
          <string>channel</string>
        </entry>
      </data>
    </step>
    <step>
      <sequenceNumber>4</sequenceNumber>
      <name>sex</name>
      <script>var mapping;

try {
	mapping = msg[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString(); 
} catch (e) {
	logger.error(e);
	mapping = &apos;&apos;;
}

channelMap.put(&apos;sex&apos;, validate( mapping , &apos;&apos;, new Array(new Array(&quot;M|m&quot;, &quot;Male&quot;),new Array(&quot;F|f&quot;, &quot;Female&quot;),new Array(&quot;U|u&quot;, &quot;Unknown&quot;))));</script>
      <type>Mapper</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>sex</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string>msg[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString()</string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list>
            <string-array>
              <string>&quot;M|m&quot;</string>
              <string>&quot;Male&quot;</string>
            </string-array>
            <string-array>
              <string>&quot;F|f&quot;</string>
              <string>&quot;Female&quot;</string>
            </string-array>
            <string-array>
              <string>&quot;U|u&quot;</string>
              <string>&quot;Unknown&quot;</string>
            </string-array>
          </list>
        </entry>
        <entry>
          <string>isGlobal</string>
          <string>channel</string>
        </entry>
      </data>
    </step>
    <step>
      <sequenceNumber>5</sequenceNumber>
      <name>ssn</name>
      <script>var mapping;

try {
	mapping = msg[&apos;PID&apos;][&apos;PID.19&apos;][&apos;PID.19.1&apos;].toString(); 
} catch (e) {
	logger.error(e);
	mapping = &apos;&apos;;
}

channelMap.put(&apos;ssn&apos;, validate( mapping , &apos;&apos;, new Array()));</script>
      <type>Mapper</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>ssn</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string>msg[&apos;PID&apos;][&apos;PID.19&apos;][&apos;PID.19.1&apos;].toString()</string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list/>
        </entry>
        <entry>
          <string>isGlobal</string>
          <string>channel</string>
        </entry>
      </data>
    </step>
    <step>
      <sequenceNumber>6</sequenceNumber>
      <name> (out)</name>
      <script>tmp = validate(&apos;&apos;, &apos;&apos;, new Array());</script>
      <type>Message Builder</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>tmp</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string></string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list/>
        </entry>
      </data>
    </step>
    <step>
      <sequenceNumber>7</sequenceNumber>
      <name>lastname (out) &lt;-- Patient Identification - Patient Name - Family Name (PID.5.1) (in)</name>
      <script>tmp[&apos;lastname&apos;] = validate(msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.1&apos;].toString(), &apos;&apos;, new Array());</script>
      <type>Message Builder</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>tmp[&apos;lastname&apos;]</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string>msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.1&apos;].toString()</string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list/>
        </entry>
      </data>
    </step>
    <step>
      <sequenceNumber>8</sequenceNumber>
      <name>givenname (out) &lt;-- Patient Identification - Patient Name - Given Name (PID.5.2) (in)</name>
      <script>tmp[&apos;givenname&apos;] = validate(msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.2&apos;].toString(), &apos;&apos;, new Array());</script>
      <type>Message Builder</type>
      <data>
        <entry>
          <string>Variable</string>
          <string>tmp[&apos;givenname&apos;]</string>
        </entry>
        <entry>
          <string>Mapping</string>
          <string>msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.2&apos;].toString()</string>
        </entry>
        <entry>
          <string>DefaultValue</string>
          <string></string>
        </entry>
        <entry>
          <string>RegularExpressions</string>
          <list/>
        </entry>
      </data>
    </step>
  </steps>
  <inboundTemplate encoding="base64">TVNIfF5+XCZ8U1VOUzF8T1BOMDF8QVpJU3xDTUR8MjAwNjA3MjYxMTUxfHxBRFReQTAxfDEzNDI3
NDkyMDB8UHwyLjINCkVWTnxBMDF8MjAwNjA3MjcwODAwDQpQSUR8fDQ1MDkyNzYwNDdeXjU4Mjc2
fDAxODcyMTReNTEyODZ8fEpPSE5TT05eTUFSSU5BfHwxOTQ1MTAyN3xGfHx8VG93bnN0cmVldCA1
M1BBUklTODgwMF4xNTB8fDc3Ny83ODk0NTZ+MDQ3NiAzNTc3Mzd8fE58V3x8fDQ1MDkyNzExODgw
fHwiIl5eIiJ8fHx8fEINClpQQXwiInwwNDY5M15ERUNST0lYXkVSTlleRFIufCIifCIifHx8IiJ8
IiJ8IiJ8IiINClBWMXx8fDU1MDFeMDExM14wMnxVfDAwMDYwMjkyfHwwMDI3Nl5ERUxCQVJFXlBP
TF5eRFIufDAwMjc2XkRFTEJBUkVeUE9MXl5EUi58fDE5MDF8fHxOfDAxfHx8fCIifDAxNjE3ODI3
MDMNCk9CWHwxfFNUfEVSTk9URV5FUk5PVEV8MXx+IE8nQ09OTk9SIEhPU1BJVEFMfiBQUklNQVJZ
fkRJQUdOT1NJU35GSU5BTDogUFJJTUFSWTogSGVhZCBpbmp1cnkgd2l0aCBjb25jdXNzaW9uIC0g
bm8gbG9zcyBvZn4NCk9CWHwyfFNUfEVSTk9URV5FUk5PVEV8MXx+IE8nQ09OTk9SIEhPU1BJVEFM
fiBQUklNQVJZfkRJQUdOT1NJU35GSU5BTDogUFJJTUFSWTogSGVhZCBpbmp1cnkgd2l0aCBjb25j
dXNzaW9uIC0gbm8gbG9zcyBvZn4NCk9CWHwzfFNUfEVSTk9URV5FUk5PVEV8MXx+IE8nQ09OTk9S
IEhPU1BJVEFMfiBQUklNQVJZfkRJQUdOT1NJU35GSU5BTDogUFJJTUFSWTogSGVhZCBpbmp1cnkg
d2l0aCBjb25jdXNzaW9uIC0gbm8gbG9zcyBvZn4NCk5URXwxfHxQZXJmb3JtZWQgYXQgNDU2IFJh
ZGlvbG9neQ0KUFYyfHx8MDZeXkFaSVN8fE58fHwyMDA2MDcyNzA4MDANClpWSXwiIiIiIiJ8MDZ8
MDl8QXwwMnwiInx8fHwiInx8fHx8IiI=</inboundTemplate>
  <outboundTemplate encoding="base64">PFBhdGllbnQ+DQoJPGxhc3RuYW1lPg0KCTwvbGFzdG5hbWU+DQoJPGdpdmVubmFtZT4NCgk8L2dp
dmVubmFtZT4NCjwvUGF0aWVudD4=</outboundTemplate>
  <inboundDataType>HL7V2</inboundDataType>
  <outboundDataType>XML</outboundDataType>
  <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.3.1">
    <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.3.1">
      <handleRepetitions>true</handleRepetitions>
      <handleSubcomponents>true</handleSubcomponents>
      <useStrictParser>false</useStrictParser>
      <useStrictValidation>false</useStrictValidation>
      <stripNamespaces>true</stripNamespaces>
      <segmentDelimiter>\r</segmentDelimiter>
      <convertLineBreaks>true</convertLineBreaks>
    </serializationProperties>
    <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.3.1">
      <useStrictParser>false</useStrictParser>
      <useStrictValidation>false</useStrictValidation>
      <segmentDelimiter>\r</segmentDelimiter>
    </deserializationProperties>
    <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.3.1">
      <splitType>MSH_Segment</splitType>
      <batchScript></batchScript>
    </batchProperties>
    <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.3.1">
      <segmentDelimiter>\r</segmentDelimiter>
      <successfulACKCode>AA</successfulACKCode>
      <successfulACKMessage></successfulACKMessage>
      <errorACKCode>AE</errorACKCode>
      <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
      <rejectedACKCode>AR</rejectedACKCode>
      <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
      <msh15ACKAccept>false</msh15ACKAccept>
      <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
    </responseGenerationProperties>
    <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.3.1">
      <successfulACKCode>AA,CA</successfulACKCode>
      <errorACKCode>AE,CE</errorACKCode>
      <rejectedACKCode>AR,CR</rejectedACKCode>
      <validateMessageControlId>true</validateMessageControlId>
      <originalMessageControlId>Destination_Encoded</originalMessageControlId>
      <originalIdMapVariable></originalIdMapVariable>
    </responseValidationProperties>
  </inboundProperties>
  <outboundProperties class="com.mirth.connect.plugins.datatypes.xml.XMLDataTypeProperties" version="3.3.1">
    <serializationProperties class="com.mirth.connect.plugins.datatypes.xml.XMLSerializationProperties" version="3.3.1">
      <stripNamespaces>false</stripNamespaces>
    </serializationProperties>
    <batchProperties class="com.mirth.connect.plugins.datatypes.xml.XMLBatchProperties" version="3.3.1">
      <splitType>Element_Name</splitType>
      <elementName></elementName>
      <level>1</level>
      <query></query>
      <batchScript></batchScript>
    </batchProperties>
  </outboundProperties>
</transformer>